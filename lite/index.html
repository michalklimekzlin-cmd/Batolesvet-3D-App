<!doctype html>
<html lang="cs">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Vivere atque FruiT ‚Äì lite</title>
    <meta name="theme-color" content="#000000" />
    <link rel="stylesheet" href="../style.css" />
    <style>
      body {
        background: #05070b;
        color: #e9f2ff;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        margin: 0;
        padding: 0;
      }
      .topbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 14px 16px 8px;
      }
      .badge {
        background: rgba(255,255,255,.04);
        border: 1px solid rgba(255,255,255,.08);
        border-radius: 999px;
        padding: 4px 10px;
        font-size: .7rem;
      }
      .panel {
        padding: 14px 16px;
      }
      #log {
        background: rgba(255,255,255,.02);
        border: 1px solid rgba(255,255,255,.03);
        border-radius: 12px;
        padding: 8px 10px;
        max-height: 55vh;
        overflow-y: auto;
        font-size: .72rem;
      }
      .row {
        margin-bottom: 4px;
        opacity: .9;
      }
      .ts { opacity: .4; margin-right: 5px; }
      .src { opacity: .7; margin-right: 5px; }
      .btn {
        background: #1494ff;
        border: none;
        color: white;
        border-radius: 9px;
        padding: 4px 10px;
        font-size: .7rem;
      }
      .quick {
        display: flex;
        gap: 6px;
        margin-top: 8px;
        flex-wrap: wrap;
      }
    </style>
  </head>
  <body>
    <div class="topbar">
      <div>
        <div style="font-size:.8rem;opacity:.6;">Vivere atque FruiT</div>
        <div style="font-size:1.05rem;">Lite j√°dro</div>
      </div>
      <div class="badge" id="pulse">‚è± ƒçek√°m na puls‚Ä¶</div>
    </div>

    <div class="panel">
      <h3 style="margin:0 0 6px;font-size:.85rem;">Tok svƒõta</h3>
      <div id="log"></div>
      <div class="quick">
        <button class="btn" onclick="sendTest('ahoj od u≈æivatele')">‚û§ poslat zpr√°vu</button>
        <button class="btn" onclick="clearLog()">üßπ vyƒçistit</button>
        <button class="btn" onclick="window.location.href='../'">‚Ü©Ô∏é zpƒõt do pln√©</button>
      </div>
    </div>

    <!-- p≈ôipojen√≠ mozku -->
    <script src="../vaft.bus.js"></script>
    <script src="../vaft.agents.js"></script>
    <script src="../vaft.brains.js"></script>

    <script>
      const logBox = document.getElementById('log');
      const pulseBox = document.getElementById('pulse');

      function addRow(text, from) {
        const row = document.createElement('div');
        row.className = 'row';
        const t = new Date();
        row.innerHTML = '<span class="ts">' + t.toLocaleTimeString('cs-CZ') + '</span>' +
                        (from ? '<span class="src">[' + from + ']</span>' : '') +
                        '<span>' + text + '</span>';
        logBox.prepend(row);
        while (logBox.children.length > 120) logBox.removeChild(logBox.lastChild);
      }

      function clearLog() {
        logBox.innerHTML = '';
      }

      function sendTest(txt) {
        addRow('üì§ ' + txt, 'u≈æivatel');
        if (window.VAFT && VAFT.bus) {
          VAFT.bus.emit('vaft.signal', { from: 'lite-ui', msg: { text: txt } });
        }
      }

      // vlastn√≠ puls, aby to ≈æilo i offline
      let beat = 0;
      setInterval(() => {
        beat++;
        pulseBox.textContent = '‚ù§Ô∏è puls ' + beat;
        addRow('puls ' + beat, 'üíì syst√©m');
      }, 2500);

      // pokud bƒõ≈æ√≠ hlavn√≠ VAFT bus, napoj√≠me se
      if (window.VAFT && VAFT.bus) {
        VAFT.bus.on('vaft.heartbeat', d => addRow('‚ù§Ô∏è heartbeat ' + d.beat, d.from));
        VAFT.bus.on('vaft.output', d => addRow('üí¨ ' + (d.text || 'v√Ωstup'), d.from));
        VAFT.bus.on('vaft.signal', d => addRow('üì° sign√°l', d.from));
        VAFT.bus.on('vaft.diagnostic', d => addRow('‚öôÔ∏è ' + d.msg, d.from));
      } else {
        addRow('‚ö†Ô∏è VAFT bus nen√≠ k dispozici ‚Äì bƒõ≈æ√≠m samostatnƒõ', 'syst√©m');
      }
    </script>
  </body>
</html>
